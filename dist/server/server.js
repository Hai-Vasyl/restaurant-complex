(()=>{"use strict";var e={n:r=>{var t=r&&r.__esModule?()=>r.default:()=>r;return e.d(t,{a:t}),t},d:(r,t)=>{for(var n in t)e.o(t,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:t[n]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)};const r=require("@babel/runtime/regenerator");var t=e.n(r);const n=require("@babel/runtime/helpers/asyncToGenerator");var a=e.n(n);const s=require("express");var c=e.n(s);const o=require("mongoose");var u=e.n(o);const i=require("body-parser");var p=e.n(i);const d=require("express-validator"),l=require("@babel/runtime/helpers/defineProperty");var f=e.n(l),m=new o.Schema({username:{type:String,required:!0,unique:!0},email:{type:String,required:!0,unique:!0},password:{type:String,required:!0},ava:{type:String,required:!0,default:"https://restaurant-bucket.s3.eu-central-1.amazonaws.com/114-1149878_setting-user-avatar-in-specific-size-without-breaking.png"},firstname:{type:String,default:""},lastname:{type:String,default:""},phone:{type:String,default:""},bio:{type:String,default:""},birth:{type:Date,default:""},role:{type:String,required:!0,default:"user",enum:["user","admin"]},date:{type:Date,required:!0}});const v=(0,o.model)("User",m);var g=new o.Schema({title:{type:String,required:!0},location:{type:String,required:!0},description:{type:String,required:!0},food:{type:String,required:!0},servicesIncluded:{type:String,required:!0},services:{type:String,required:!0},entertainment:{type:String,required:!0},contacts:{type:String,required:!0},road:{type:String,required:!0}});const h=(0,o.model)("HRcomplex",g);var y=new o.Schema({path:{type:String,required:!0},hrComplex:{type:o.Types.ObjectId,ref:"HRcomplex",required:!0},title:{type:String,default:""},description:{type:String,default:""},date:{type:Date,required:!0}});const b=(0,o.model)("Image",y);var x=new o.Schema({settlement:{type:Date,required:!0},eviction:{type:Date,required:!0},hrComplex:{type:o.Types.ObjectId,ref:"HRcomplex",required:!0},booked:{type:Boolean,required:!0,default:!1},price:{type:Number,required:!0}});const w=(0,o.model)("DateRange",x);var k=new o.Schema({buyer:{type:o.Types.ObjectId,ref:"User",required:!0},hrComplex:{type:o.Types.ObjectId,ref:"HRcomplex",required:!0},price:{type:Number,required:!0},settlement:{type:Date,required:!0},eviction:{type:Date,required:!0},date:{type:Date,required:!0}});const j=(0,o.model)("Order",k);var O=new o.Schema({hrComplex:{type:o.Types.ObjectId,ref:"HRcomplex",required:!0},owner:{type:o.Types.ObjectId,ref:"User",required:!0},content:{type:String,required:!0},date:{type:Date,required:!0},response:{type:o.Types.ObjectId,ref:"Response"}});const S=(0,o.model)("Response",O),q=require("bcrypt");var I=e.n(q);const D=require("jsonwebtoken");var R=e.n(D);const C=require("dotenv"),_=require("aws-sdk");var P=e.n(_);const E=require("uuid");function B(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function A(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?B(Object(t),!0).forEach((function(r){f()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):B(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}(0,C.config)();var T=process.env,M=T.AWS_ID,U=T.AWS_SECRET,G=T.AWS_BUCKET,K=T.JWT_SECRET,L=new(P().S3)({accessKeyId:M,secretAccessKey:U}),W=function(){var e=a()(t().mark((function e(r,n,a){var s,c,o,u,i,p,d,l=arguments;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=l.length>3&&void 0!==l[3]&&l[3],c=s?{_id:{$ne:a},username:r}:{username:r},o=s?{_id:{$ne:a},email:n}:{email:n},e.next=5,v.findOne(c);case 5:return u=e.sent,e.next=8,v.findOne(o);case 8:if(i=e.sent,p=u&&Object.values(u).length,d=i&&Object.values(i).length,!p||!d){e.next=15;break}return e.abrupt("return",{errors:[{msg:"Ім'я користувача не унікальне!",param:"username"},{msg:"Електронна пошта не є унікальною!",param:"email"}]});case 15:if(!p){e.next=19;break}return e.abrupt("return",{errors:[{msg:"Користувач з цим іменем користувача вже існує!",param:"username"}]});case 19:if(!d){e.next=21;break}return e.abrupt("return",{errors:[{msg:"Користувач з цією електронною поштою вже існує!",param:"email"}]});case 21:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),H=function(){var e=a()(t().mark((function e(r,n){var a,s,c,o,u,i,p,l,f,m,g,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(a=(0,d.validationResult)(r)).isEmpty()){e.next=4;break}return e.abrupt("return",n.status(400).json({errors:a.array()}));case 4:return s=r.body,c=s.username,o=s.email,u=s.password,i=s.role,p=s.ava,e.next=7,W(c,o);case 7:return(l=e.sent)&&l.errors&&l.errors.length&&n.staus(400).json(l),e.next=11,I().hash(u,12);case 11:return f=e.sent,m=new v({username:c,email:o,role:i,password:f,ava:p,date:new Date}),e.next=15,m.save();case 15:g=e.sent,h=R().sign({userId:g._id},K),n.status(201).json({token:h,user:g}),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),n.status(400).json("Register user error: ".concat(e.t0.message));case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(r,t){return e.apply(this,arguments)}}(),N=function(){var e=a()(t().mark((function e(r,n){var a,s,c,o,u,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(a=(0,d.validationResult)(r)).isEmpty()){e.next=4;break}return e.abrupt("return",n.status(400).json({errors:a.array()}));case 4:return s=r.body,c=s.email,o=s.password,e.next=7,v.findOne({email:c});case 7:if(u=e.sent,u&&Object.values(u).length){e.next=11;break}return e.abrupt("return",n.status(400).json({errors:[{msg:"Користувач з цією електронною поштою не існує!",param:"email"}]}));case 11:return e.next=13,I().compare(o,u.password);case 13:if(e.sent){e.next=16;break}return e.abrupt("return",n.status(400).json({errors:[{msg:"Пароль не правильний, спробуйте ще раз!",param:"password"}]}));case 16:i=R().sign({userId:u._id},K),n.status(201).json({token:i,user:u}),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),n.status(400).json("Login user error: ".concat(e.t0.message));case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(r,t){return e.apply(this,arguments)}}(),z=function(){var e=a()(t().mark((function e(r,n){var a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.params.userId,e.next=4,v.findById(a).select("-password");case 4:s=e.sent,n.json(s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n.status(400).json("Getting user info error: ".concat(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(r,t){return e.apply(this,arguments)}}(),F=function(){var e=a()(t().mark((function e(r,n){var a,s,c,o,u,i,p,l,f,m,g,h,y,b,x;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(a=(0,d.validationResult)(r)).isEmpty()){e.next=4;break}return e.abrupt("return",n.status(400).json({errors:a.array()}));case 4:return s=r.body,c=s.username,o=s.email,u=s.firstname,i=s.lastname,p=s.phone,l=s.bio,f=s.birth,m=s.password,g=r.userId,e.next=8,W(c,o,g,!0);case 8:if(!((h=e.sent)&&h.errors&&h.errors.length)){e.next=11;break}return e.abrupt("return",n.status(400).json(h));case 11:if(y={username:c,email:o,firstname:u,lastname:i,phone:p,bio:l,birth:f,date:new Date},void 0===m){e.next=17;break}return e.next=15,I().hash(m,12);case 15:b=e.sent,y=A(A({},y),{},{password:b});case 17:return e.next=19,v.findByIdAndUpdate(g,A({},y));case 19:return e.next=21,v.findById(g);case 21:x=e.sent,n.json(x),e.next=28;break;case 25:e.prev=25,e.t0=e.catch(0),n.status(400).json("Updating user info error: ".concat(e.t0.message));case 28:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(r,t){return e.apply(this,arguments)}}(),J=function(){var e=a()(t().mark((function e(r,n){var a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.find().select("username email ava role date");case 3:a=e.sent,n.json(a),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n.status(400).json("Getting all users error: ".concat(e.t0.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,t){return e.apply(this,arguments)}}(),$=function(){var e=a()(t().mark((function e(r,n){var s,c,o,u,i,p,d;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=r.file,c=r.userId,Object.keys(s).length){e.next=4;break}return e.abrupt("return",n.status(400).json("File doesn't exists!"));case 4:return e.next=6,v.findById(c);case 6:if((o=e.sent)&&o.ava){e.next=9;break}return e.abrupt("return",n.status(400).json("User doesn't exists!"));case 9:if("114-1149878_setting-user-avatar-in-specific-size-without-breaking.png"===(u=(u=o.ava.split("/"))[u.length-1])){e.next=14;break}return e.next=14,L.deleteObject({Key:u,Bucket:G}).promise();case 14:i=s.originalname.split("."),p=i[i.length-1],d={Bucket:G,Key:"".concat((0,E.v4)(),".").concat(p),Body:s.buffer},L.upload(d,function(){var e=a()(t().mark((function e(r,a){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=2;break}return e.abrupt("return",n.status(400).json("Updating user avatar error: ".concat(r.message)));case 2:return e.next=4,v.updateOne({_id:c},{ava:a.Location});case 4:n.json({ava:a.Location});case 5:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),n.status(400).json("Changing avatar user error: ".concat(e.t0.message));case 23:case"end":return e.stop()}}),e,null,[[0,20]])})));return function(r,t){return e.apply(this,arguments)}}();(0,C.config)();var Q=process.env.JWT_SECRET;const V=function(){var e=a()(t().mark((function e(r,n,a){var s,c,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"OPTIONS"!==r.method){e.next=3;break}return e.abrupt("return",a());case 3:if(s=r.headers.authorization){e.next=6;break}return e.abrupt("return",n.status(401).json("Access denied!"));case 6:if(c=s.split(" ")[1]){e.next=9;break}return e.abrupt("return",n.status(401).json("Access denied!"));case 9:if(o=R().verify(c,Q),u=o.userId){e.next=12;break}return e.abrupt("return",n.status(401).json("Access denied!"));case 12:r.userId=u,a(),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),n.status(401).json("Access denied, error: ".concat(e.t0.message));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(r,t,n){return e.apply(this,arguments)}}(),X=require("multer");var Y=e.n(X),Z=(0,s.Router)(),ee=Y().memoryStorage(),re=Y()({storage:ee}).single("avatar");Z.post("/register",[(0,d.check)("username").isLength({min:4,max:15}).withMessage("Ім'я користувача має містити щонайменше від 4 до 15 символів!"),(0,d.check)("email").isEmail().withMessage("Електронна адреса неправильна!"),(0,d.check)("password").isLength({min:3,max:25}).withMessage("Пароль повинен містити принаймні від 3 до 25 символів!")],H),Z.post("/login",[(0,d.check)("email").isEmail().withMessage("Електронна адреса неправильна!"),(0,d.check)("password").isLength({min:3,max:25}).withMessage("Пароль повинен містити принаймні від 3 до 25 символів!")],N),Z.get("/get-info/:userId",z),Z.post("/update-user-password",V,[(0,d.check)("username").isLength({min:4,max:15}).withMessage("Ім'я користувача має містити щонайменше від 4 до 15 символів!"),(0,d.check)("email").isEmail().withMessage("Електронна адреса неправильна!"),(0,d.check)("password").isLength({min:3,max:25}).withMessage("Пароль повинен містити принаймні від 3 до 25 символів!")],F),Z.post("/update-user",V,[(0,d.check)("username").isLength({min:4,max:15}).withMessage("Ім'я користувача має містити щонайменше від 4 до 15 символів!"),(0,d.check)("email").isEmail().withMessage("Електронна адреса неправильна!")],F),Z.get("/users",J),Z.post("/change-avatar",V,re,$);const te=Z;var ne=function(){var e=a()(t().mark((function e(r,n){var a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.body.hrComplex,e.next=4,w.find({hrComplex:a});case 4:s=e.sent,n.json(s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n.status(400).json("Getting DateRanges error: ".concat(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(r,t){return e.apply(this,arguments)}}(),ae=function(){var e=a()(t().mark((function e(r,n){var a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=new w(r.body),e.next=4,a.save();case 4:s=e.sent,n.status(201).json({dateRange:s}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n.status(400).json("Creating DateRange error: ".concat(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(r,t){return e.apply(this,arguments)}}(),se=function(){var e=a()(t().mark((function e(r,n){var a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.params.dateId,e.next=4,w.findByIdAndDelete(a);case 4:n.json({message:"Date range deleted successfully"}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n.status(400).json("Deleting DateRange error: ".concat(e.t0.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,t){return e.apply(this,arguments)}}(),ce=function(){var e=a()(t().mark((function e(r,n){var a,s,c,o,u,i,p,d,l,f,m,g,h,y;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.body,s=a.dates,c=a.hrComplex,o=a.user,u=o.firstname,i=o.lastname,p=o.phone,d=r.userId,e.next=5,w.find({hrComplex:c});case 5:return l=e.sent,e.next=8,v.updateOne({_id:d},{firstname:u,lastname:i,phone:p});case 8:for(f=!1,m=0;m<l.length;m++)for(g=0;g<s.length;g++)l[m]._id===s[g]._id&&l[m].booked&&(f=!0,s[g].booked=!0);if(!f){e.next=12;break}return e.abrupt("return",n.json({dates:s,message:"Один або більше діапазонів дат вже заброньовані!"}));case 12:h=0;case 13:if(!(h<s.length)){e.next=22;break}return e.next=16,w.findByIdAndUpdate(s[h]._id,{booked:!0});case 16:return y=new j({buyer:d,hrComplex:c,price:s[h].price,settlement:s[h].settlement,eviction:s[h].eviction,date:new Date}),e.next=19,y.save();case 19:h++,e.next=13;break;case 22:n.json({message:"Date range updated successfully"}),e.next=28;break;case 25:e.prev=25,e.t0=e.catch(0),n.status(400).json("Booking DateRange error: ".concat(e.t0.message));case 28:case"end":return e.stop()}}),e,null,[[0,25]])})));return function(r,t){return e.apply(this,arguments)}}(),oe=function(){var e=a()(t().mark((function e(r,n){var a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.userId,e.next=4,j.find({buyer:a});case 4:s=e.sent,n.json(s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n.status(400).json("Getting ordered DateRange error: ".concat(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(r,t){return e.apply(this,arguments)}}(),ue=(0,s.Router)();ue.post("/all",ne),ue.post("/create-date-range",V,ae),ue.delete("/delete-date-range/:dateId",V,se),ue.post("/booking",V,ce),ue.post("/ordered",V,oe);const ie=ue;var pe=function(){var e=a()(t().mark((function e(r,n){var a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=new h(r.body),e.next=4,a.save();case 4:s=e.sent,n.status(201).json(s._id),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n.status(400).json("Creating HRcomplex error: ".concat(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(r,t){return e.apply(this,arguments)}}(),de=function(){var e=a()(t().mark((function e(r,n){var a;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.findById(r.body.hrComplex);case 3:a=e.sent,n.status(200).json(a),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),n.status(400).json("Getting HRcomplex error: ".concat(e.t0.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(r,t){return e.apply(this,arguments)}}(),le=(0,s.Router)();le.post("/create-hrc",pe),le.post("/get-info",de);const fe=le;(0,C.config)();var me=process.env,ve=me.AWS_ID,ge=me.AWS_SECRET,he=me.AWS_BUCKET,ye=new(P().S3)({accessKeyId:ve,secretAccessKey:ge}),be=function(){var e=a()(t().mark((function e(r,n){var s,c,o,u,i,p,d,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{s=r.file,c=r.body,o=c.hrComplex,u=c.title,i=c.description,p=s.originalname.split("."),d=p[p.length-1],l={Bucket:he,Key:"".concat((0,E.v4)(),".").concat(d),Body:s.buffer},ye.upload(l,function(){var e=a()(t().mark((function e(r,a){var s,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=2;break}return e.abrupt("return",n.status(400).json("Uploading file error: ".concat(r.message)));case 2:return s=new b({path:a.Location,hrComplex:o,title:u,description:i,date:new Date}),e.next=5,s.save();case 5:c=e.sent,n.status(200).send(c);case 7:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}())}catch(e){n.json("Upload image error: ".concat(e.message))}case 1:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),xe=function(){var e=a()(t().mark((function e(r,n){var a,s,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.params.imageId,e.next=4,b.findById(a);case 4:return s=e.sent,c=(c=s.path.split("/"))[c.length-1],e.next=9,ye.deleteObject({Key:c,Bucket:he}).promise();case 9:return e.next=11,b.deleteOne({_id:a});case 11:n.json({message:"Image deleted successfully!"}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),n.json("Deleting image error: ".concat(e.t0.message));case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(r,t){return e.apply(this,arguments)}}(),we=function(){var e=a()(t().mark((function e(r,n){var a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.body.hrComplex,e.next=4,b.find({hrComplex:a}).sort({date:-1});case 4:s=e.sent,n.json(s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n.json("Getting images error: ".concat(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(r,t){return e.apply(this,arguments)}}(),ke=function(){var e=a()(t().mark((function e(r,n){var a,s,c,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.body,s=a.title,c=a.description,o=r.params.imageId,e.next=5,b.updateOne({_id:o},{title:s,description:c});case 5:return e.next=7,b.findById(o);case 7:u=e.sent,n.json(u),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),n.json("Updating image error: ".concat(e.t0.message));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(r,t){return e.apply(this,arguments)}}(),je=(0,s.Router)(),Oe=Y().memoryStorage(),Se=Y()({storage:Oe}).single("image");je.post("/upload-image",V,Se,be),je.delete("/delete-image/:imageId",V,xe),je.post("/all",we),je.post("/update-image/:imageId",V,ke);const qe=je,Ie=require("@babel/runtime/helpers/toConsumableArray");var De=e.n(Ie);function Re(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function Ce(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?Re(Object(t),!0).forEach((function(r){f()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Re(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var _e=function(){var e=a()(t().mark((function e(r,n){var a,s,c,o,u,i,p;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.userId,s=r.body,c=s.hrComplex,o=s.content,u=s.response,i=new S({hrComplex:c,owner:a,content:o,date:new Date,response:u}),e.next=6,i.save();case 6:p=e.sent,n.status(201).json(p),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),n.status(400).json("Creating response error: ".concat(e.t0.message));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(r,t){return e.apply(this,arguments)}}(),Pe=function(){var e=a()(t().mark((function e(r,n){var a,s,c,o,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.body.hrComplex,e.next=4,S.find({hrComplex:a,response:null}).populate({path:"owner",select:"username ava role"}).sort({date:-1});case 4:s=e.sent,c=De()(s),o=0;case 7:if(!(o<c.length)){e.next=15;break}return e.next=10,S.find({response:c[o]._id}).populate({path:"owner",select:"username ava role"}).sort({date:-1});case 10:u=e.sent,c[o]=Ce(Ce({},c[o]._doc),{},{answers:u});case 12:o++,e.next=7;break;case 15:n.json(c),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),n.status(400).json("Getting responses error: ".concat(e.t0.message));case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(r,t){return e.apply(this,arguments)}}(),Ee=function(){var e=a()(t().mark((function e(r,n){var a,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.params.responseId,s=r.userId,e.next=5,S.findOneAndDelete({_id:a,owner:s});case 5:n.json({message:"Response deleted successfully!"}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n.status(400).json("Deleting response error: ".concat(e.t0.message));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(r,t){return e.apply(this,arguments)}}(),Be=(0,s.Router)();Be.post("/create",V,_e),Be.post("/get-all",Pe),Be.delete("/delete/:responseId",V,Ee);const Ae=Be,Te=require("cors");var Me=e.n(Te);(0,C.config)();var Ue=process.env,Ge=Ue.PORT,Ke=Ue.MONGO_USER,Le=Ue.MONGO_PASS,We=Ue.MONGO_DB;a()(t().mark((function e(){var r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(r=c()()).use(Me()()),r.use(p().urlencoded({extended:!1})),r.use(p().json()),e.next=7,u().connect("mongodb+srv://".concat(Ke,":").concat(Le,"@cluster0.osxef.mongodb.net/").concat(We,"?retryWrites=true&w=majority"),{useCreateIndex:!0,useNewUrlParser:!0,useUnifiedTopology:!0,useFindAndModify:!1},(function(){return console.log("MongoDB successfully connected!")}));case 7:r.use("/auth",te),r.use("/daterange",ie),r.use("/hrcomplex",fe),r.use("/image",qe),r.use("/response",Ae),r.use(c().static("dist/client")),r.listen(Ge,(function(){return console.log("Server started on port: ".concat(Ge))})),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.error("Server error: ".concat(e.t0.message));case 19:case"end":return e.stop()}}),e,null,[[0,16]])})))()})();